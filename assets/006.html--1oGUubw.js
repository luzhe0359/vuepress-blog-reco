import{_ as p,r as e,o,c as l,a as s,b as n,d as t,e as c}from"./app-wc4Qvs9_.js";const i="/img/front/006-01.gif",r={},u=c('<blockquote><p>记录一次接手别人代码的经历 - TinyMCE 自定义表情包</p></blockquote><p>“那个 xxx 没做过表情功能，你在 xxx 项目做过，这个功能你来完成吧。” 一句简短的话语，开启了改造表情之路。</p><p>简单了解一下项目，使用的是 vue 结合 TinyMCE 富文本，开始造吧。</p><h2 id="一、效果图" tabindex="-1"><a class="header-anchor" href="#一、效果图" aria-hidden="true">#</a> 一、效果图</h2><p>整体效果图如下： <img src="'+i+`" alt="006-01.gif"></p><h2 id="二、准备工作" tabindex="-1"><a class="header-anchor" href="#二、准备工作" aria-hidden="true">#</a> 二、准备工作</h2><ul><li>表情包 既然是自定义表情包，必然得自备一些表情图片（文末免费领取 QQ 表情包——gif 格式）。</li></ul><h2 id="三、使用-tinymce-vue" tabindex="-1"><a class="header-anchor" href="#三、使用-tinymce-vue" aria-hidden="true">#</a> 三、使用 tinymce-vue</h2><h3 id="_1-安装" tabindex="-1"><a class="header-anchor" href="#_1-安装" aria-hidden="true">#</a> 1. 安装</h3><ul><li>Vue3.x <code>npm install --save &quot;@tinymce/tinymce-vue@^4&quot;</code></li><li>Vue2.x <code>npm install --save &quot;@tinymce/tinymce-vue@^3&quot;</code></li></ul><h3 id="_2-使用" tabindex="-1"><a class="header-anchor" href="#_2-使用" aria-hidden="true">#</a> 2. 使用</h3><p>引入富文本，在工具栏配置自带的表情包。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>editor v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;content&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;tinymce&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;tinymce-vue&quot;</span> <span class="token operator">:</span>init<span class="token operator">=</span><span class="token string">&quot;init&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> Editor <span class="token keyword">from</span> <span class="token string">&#39;@tinymce/tinymce-vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Editor&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;editor&#39;</span><span class="token operator">:</span> Editor
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">init</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">&#39;#tinymce-vue&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token string">&#39;emoticons&#39;</span><span class="token punctuation">,</span> <span class="token comment">// tinymce自带表情</span>
        <span class="token literal-property property">toolbar</span><span class="token operator">:</span> <span class="token string">&#39;emoticons&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-自定义表情包" tabindex="-1"><a class="header-anchor" href="#_3-自定义表情包" aria-hidden="true">#</a> 3. 自定义表情包</h3><p>在 init 中新增自定义表情配置，并新增表情列表弹框（见末尾完整代码）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">setup</span><span class="token operator">:</span> <span class="token parameter">editor</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 自定义表情</span>
  editor<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>registry<span class="token punctuation">.</span><span class="token function">addButton</span><span class="token punctuation">(</span><span class="token string">&#39;emoji&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;&lt;svg t=&quot;1666853449306&quot; class=&quot;icon&quot; viewBox=&quot;0 0 1024 1024&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; p-id=&quot;3854&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M512 959.1c-114.6 0-229.1-43.6-316.3-130.9-174.3-174.4-174.2-458.1 0.2-632.4C298.7 93 445.6 46.6 589 71.5c14.3 2.5 23.9 16.1 21.4 30.4-2.5 14.3-16.1 23.9-30.4 21.4-126.5-22-256.2 19-347 109.7-153.9 153.8-154 404.2-0.2 558.1 153.8 153.9 404.2 154 558.1 0.2s154-404.2 0.2-558.2c-15.4-15.4-32-29.5-49.6-42.1-11.8-8.5-14.5-24.9-6-36.7 8.5-11.8 24.9-14.5 36.7-6 19.8 14.2 38.7 30.3 56.1 47.7 174.3 174.4 174.2 458.1-0.2 632.5-87.1 87-201.6 130.6-316.1 130.6z&quot; p-id=&quot;3855&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M312.8 410.7m-42.8 0a42.8 42.8 0 1 0 85.6 0 42.8 42.8 0 1 0-85.6 0Z&quot; p-id=&quot;3856&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M715.6 410.9m-42.5 0a42.5 42.5 0 1 0 85 0 42.5 42.5 0 1 0-85 0Z&quot; p-id=&quot;3857&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M281.1 553.2v0.4c0 127.5 103.3 231 230.9 231s231-103.3 231-230.9v-0.4l-461.9-0.1z&quot; fill=&quot;#FFA786&quot; p-id=&quot;3858&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M512 810.9s-0.1 0 0 0c-141.9 0-257.3-115.5-257.2-257.3 0-7.9 3.2-26.2 32.7-26.3h82.4c67.1 0 160.4 0 236.9 0.1l133.6 0.1c28.6 0.1 28.9 26 28.9 26.3-0.1 141.7-115.5 257.1-257.3 257.1zM309 579.8c12.9 100.5 99 178.5 202.9 178.5h0.1c103.9 0 190-77.9 203-178.4-82.1 0-324-0.1-406-0.1z&quot; p-id=&quot;3859&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M673.4 124.4m-26.3 0a26.3 26.3 0 1 0 52.6 0 26.3 26.3 0 1 0-52.6 0Z&quot; fill=&quot;#FFA786&quot; p-id=&quot;3860&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tooltip</span><span class="token operator">:</span> <span class="token string">&#39;添加一段文字&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">onAction</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 打开表情弹框</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-插入表情" tabindex="-1"><a class="header-anchor" href="#_4-插入表情" aria-hidden="true">#</a> 4. 插入表情</h3><p>为表情新增点击事件，点击后插入到富文本中。将光标移动到插入的表情后并聚焦。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 选择表情</span>
<span class="token function">choose</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取当前富文本</span>
  <span class="token keyword">let</span> ed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tinymce<span class="token punctuation">.</span>editor
  <span class="token comment">// 获取插入对象</span>
  <span class="token keyword">let</span> range <span class="token operator">=</span> ed<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">getRng</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 创建img</span>
  <span class="token keyword">let</span> imgNode <span class="token operator">=</span> ed<span class="token punctuation">.</span><span class="token function">getDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span>
  imgNode<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/qq/old/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.gif</span><span class="token template-punctuation string">\`</span></span>
  <span class="token comment">// 插入表情</span>
  range<span class="token punctuation">.</span><span class="token function">insertNode</span><span class="token punctuation">(</span>imgNode<span class="token punctuation">)</span>
  <span class="token comment">// 关闭弹框</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token comment">// 光标聚焦并移动至插入的表情后</span>
  ed<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;seleceAll&#39;</span><span class="token punctuation">)</span>
  ed<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">getRng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  ed<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-完整代码" tabindex="-1"><a class="header-anchor" href="#_5-完整代码" aria-hidden="true">#</a> 5. 完整代码</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>editor v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;content&quot;</span> ref<span class="token operator">=</span><span class="token string">&quot;tinymce&quot;</span> id<span class="token operator">=</span><span class="token string">&quot;tinymce-vue&quot;</span> <span class="token operator">:</span>init<span class="token operator">=</span><span class="token string">&quot;init&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>dialog title<span class="token operator">=</span><span class="token string">&quot;自定义表情包&quot;</span> <span class="token operator">:</span>visible<span class="token punctuation">.</span>sync<span class="token operator">=</span><span class="token string">&quot;dialogVisible&quot;</span> width<span class="token operator">=</span><span class="token string">&quot;600px&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;emoji&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;emoji-item&quot;</span> v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;item in 132&quot;</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;item&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;\`/qq/old/\${item}.gif\`&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;error&quot;</span> @click<span class="token operator">=</span><span class="token string">&quot;choose(item)&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>dialog<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token comment">// 引入tinymce-vue</span>
<span class="token keyword">import</span> Editor <span class="token keyword">from</span> <span class="token string">&#39;@tinymce/tinymce-vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Editor&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;editor&#39;</span><span class="token operator">:</span> Editor
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">dialogVisible</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">init</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">&#39;#tinymce-vue&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token string">&#39;emoticons&#39;</span><span class="token punctuation">,</span> <span class="token comment">// tinymce自带表情</span>
        <span class="token literal-property property">toolbar</span><span class="token operator">:</span> <span class="token string">&#39;emoticons emoji oneButton&#39;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">setup</span><span class="token operator">:</span> <span class="token parameter">editor</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 自定义表情</span>
          editor<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>registry<span class="token punctuation">.</span><span class="token function">addButton</span><span class="token punctuation">(</span><span class="token string">&#39;emoji&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token comment">// 使用svg表情图标</span>
            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;&lt;svg t=&quot;1666853449306&quot; class=&quot;icon&quot; viewBox=&quot;0 0 1024 1024&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; p-id=&quot;3854&quot; width=&quot;18&quot; height=&quot;18&quot;&gt;&lt;path d=&quot;M512 959.1c-114.6 0-229.1-43.6-316.3-130.9-174.3-174.4-174.2-458.1 0.2-632.4C298.7 93 445.6 46.6 589 71.5c14.3 2.5 23.9 16.1 21.4 30.4-2.5 14.3-16.1 23.9-30.4 21.4-126.5-22-256.2 19-347 109.7-153.9 153.8-154 404.2-0.2 558.1 153.8 153.9 404.2 154 558.1 0.2s154-404.2 0.2-558.2c-15.4-15.4-32-29.5-49.6-42.1-11.8-8.5-14.5-24.9-6-36.7 8.5-11.8 24.9-14.5 36.7-6 19.8 14.2 38.7 30.3 56.1 47.7 174.3 174.4 174.2 458.1-0.2 632.5-87.1 87-201.6 130.6-316.1 130.6z&quot; p-id=&quot;3855&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M312.8 410.7m-42.8 0a42.8 42.8 0 1 0 85.6 0 42.8 42.8 0 1 0-85.6 0Z&quot; p-id=&quot;3856&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M715.6 410.9m-42.5 0a42.5 42.5 0 1 0 85 0 42.5 42.5 0 1 0-85 0Z&quot; p-id=&quot;3857&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M281.1 553.2v0.4c0 127.5 103.3 231 230.9 231s231-103.3 231-230.9v-0.4l-461.9-0.1z&quot; fill=&quot;#FFA786&quot; p-id=&quot;3858&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M512 810.9s-0.1 0 0 0c-141.9 0-257.3-115.5-257.2-257.3 0-7.9 3.2-26.2 32.7-26.3h82.4c67.1 0 160.4 0 236.9 0.1l133.6 0.1c28.6 0.1 28.9 26 28.9 26.3-0.1 141.7-115.5 257.1-257.3 257.1zM309 579.8c12.9 100.5 99 178.5 202.9 178.5h0.1c103.9 0 190-77.9 203-178.4-82.1 0-324-0.1-406-0.1z&quot; p-id=&quot;3859&quot;&gt;&lt;/path&gt;&lt;path d=&quot;M673.4 124.4m-26.3 0a26.3 26.3 0 1 0 52.6 0 26.3 26.3 0 1 0-52.6 0Z&quot; fill=&quot;#FFA786&quot; p-id=&quot;3860&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">tooltip</span><span class="token operator">:</span> <span class="token string">&#39;自定义表情包&#39;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">onAction</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token comment">// 打开表情列表弹框</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 自定义其他工具栏选项</span>
          editor<span class="token punctuation">.</span>ui<span class="token punctuation">.</span>registry<span class="token punctuation">.</span><span class="token function">addButton</span><span class="token punctuation">(</span><span class="token string">&#39;oneButton&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;Insert Hello&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">tooltip</span><span class="token operator">:</span> <span class="token string">&#39;添加一段文字&#39;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">onAction</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              editor<span class="token punctuation">.</span><span class="token function">insertContent</span><span class="token punctuation">(</span><span class="token string">&#39;Hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 选择表情</span>
    <span class="token function">choose</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取当前富文本</span>
      <span class="token keyword">let</span> ed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tinymce<span class="token punctuation">.</span>editor
      ed<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 默认聚焦一次，防止初始化后直接插入表情光标bug(在表情前方)</span>
      <span class="token comment">// 获取插入对象</span>
      <span class="token keyword">let</span> range <span class="token operator">=</span> ed<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">getRng</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 创建img</span>
      <span class="token keyword">let</span> imgNode <span class="token operator">=</span> ed<span class="token punctuation">.</span><span class="token function">getDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;img&#39;</span><span class="token punctuation">)</span>
      imgNode<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">/qq/old/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.gif</span><span class="token template-punctuation string">\`</span></span>
      <span class="token comment">// 插入表情</span>
      range<span class="token punctuation">.</span><span class="token function">insertNode</span><span class="token punctuation">(</span>imgNode<span class="token punctuation">)</span>
      <span class="token comment">// 关闭弹框</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisible <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token comment">// 光标聚焦并移动至插入的表情后</span>
      ed<span class="token punctuation">.</span><span class="token function">execCommand</span><span class="token punctuation">(</span><span class="token string">&#39;seleceAll&#39;</span><span class="token punctuation">)</span>
      ed<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">getRng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      ed<span class="token punctuation">.</span><span class="token function">fire</span><span class="token punctuation">(</span><span class="token string">&#39;change&#39;</span><span class="token punctuation">)</span> <span class="token comment">// 触发change事件，解决v-model不生效bug</span>
      ed<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>style scoped<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>emoji <span class="token punctuation">{</span>
  <span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span>
  flex<span class="token operator">-</span>wrap<span class="token operator">:</span> wrap<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span>emoji <span class="token punctuation">.</span>emoji<span class="token operator">-</span>item <span class="token punctuation">{</span>
  <span class="token literal-property property">display</span><span class="token operator">:</span> flex<span class="token punctuation">;</span>
  justify<span class="token operator">-</span>content<span class="token operator">:</span> center<span class="token punctuation">;</span>
  align<span class="token operator">-</span>items<span class="token operator">:</span> center<span class="token punctuation">;</span>
  margin<span class="token operator">-</span>left<span class="token operator">:</span> 10px<span class="token punctuation">;</span>
  margin<span class="token operator">-</span>bottom<span class="token operator">:</span> 8px<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

img <span class="token punctuation">{</span>
  <span class="token literal-property property">width</span><span class="token operator">:</span> 24px<span class="token punctuation">;</span>
  <span class="token literal-property property">height</span><span class="token operator">:</span> 24px<span class="token punctuation">;</span>
  <span class="token literal-property property">cursor</span><span class="token operator">:</span> pointer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="四、总结" tabindex="-1"><a class="header-anchor" href="#四、总结" aria-hidden="true">#</a> 四、总结</h2><p>自定义表情包，本质上就是把图片插入到富文本中。</p>`,23),k={href:"https://download.csdn.net/download/weixin_44388523/12510553",target:"_blank",rel:"noopener noreferrer"},d={href:"https://zugelu.com/",target:"_blank",rel:"noopener noreferrer"},v={href:"https://juejin.cn/user/1151943917971031",target:"_blank",rel:"noopener noreferrer"},m={href:"https://blog.csdn.net/weixin_44388523",target:"_blank",rel:"noopener noreferrer"},g={href:"https://v.zugelu.com",target:"_blank",rel:"noopener noreferrer"},b=s("strong",null,"关注足各路、前端不迷路！",-1);function q(h,y){const a=e("ExternalLinkIcon");return o(),l("div",null,[u,s("p",null,[n("QQ 表情包，私聊我免费领取。地址："),s("a",k,[n("qq 动态表情包 gif 格式_新版&旧版&搞笑版，拿来即用的 emoji"),t(a)])]),s("p",null,[n("本文首发于"),s("a",d,[n("足各路的博客"),t(a)]),n("，后续会同步更新到"),s("a",v,[n("掘金"),t(a)]),n("、"),s("a",m,[n("CSDN"),t(a)]),n("、"),s("a",g,[n("足各路收藏夹"),t(a)]),n("。"),b])])}const _=p(r,[["render",q],["__file","006.html.vue"]]);export{_ as default};
